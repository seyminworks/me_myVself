<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORS 프록시 서버 - ElevenLabs API</title>
    <style>
        body {
            font-family: 'Roboto Mono', monospace;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: #f9f9f9;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #333; }
        h2 { color: #555; margin-top: 30px; }
        .code {
            background: #f4f4f4;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Roboto Mono', monospace;
            overflow-x: auto;
            margin: 15px 0;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ElevenLabs API CORS 프록시 서버</h1>
        
        <div class="warning">
            <strong>주의:</strong> 브라우저에서 직접 ElevenLabs API를 호출할 때 CORS(Cross-Origin Resource Sharing) 정책으로 인해 차단될 수 있습니다.
        </div>

        <h2>해결 방법 1: 로컬 프록시 서버 사용</h2>
        
        <p>다음 Node.js 프록시 서버를 사용하여 CORS 문제를 해결할 수 있습니다:</p>

        <div class="code">
// cors-proxy.js
const express = require('express');
const { createProxyMiddleware } = require('http-proxy-middleware');
const cors = require('cors');

const app = express();
const PORT = 3001;

// CORS 허용
app.use(cors());

// ElevenLabs API 프록시
app.use('/api/elevenlabs', createProxyMiddleware({
  target: 'https://api.elevenlabs.io',
  changeOrigin: true,
  pathRewrite: {
    '^/api/elevenlabs': '/v1'
  },
  onProxyReq: (proxyReq, req, res) => {
    // API 키를 헤더에 추가
    if (req.headers['x-api-key']) {
      proxyReq.setHeader('xi-api-key', req.headers['x-api-key']);
    }
  }
}));

app.listen(PORT, () => {
  console.log(`CORS 프록시 서버가 포트 ${PORT}에서 실행 중입니다.`);
});
        </div>

        <p><strong>설치 및 실행:</strong></p>
        <div class="code">
npm init -y
npm install express http-proxy-middleware cors
node cors-proxy.js
        </div>

        <h2>해결 방법 2: Netlify Functions 사용</h2>
        
        <p>Netlify에 배포할 경우 Functions를 사용할 수 있습니다:</p>

        <div class="code">
// netlify/functions/elevenlabs-proxy.js
exports.handler = async (event, context) => {
  const { httpMethod, path, headers, queryStringParameters } = event;
  
  if (httpMethod !== 'GET') {
    return { statusCode: 405, body: 'Method Not Allowed' };
  }

  try {
    const apiKey = headers['x-api-key'];
    if (!apiKey) {
      return { statusCode: 401, body: 'API Key Required' };
    }

    const conversationId = queryStringParameters?.conversationId;
    if (!conversationId) {
      return { statusCode: 400, body: 'Conversation ID Required' };
    }

    const response = await fetch(
      `https://api.elevenlabs.io/v1/convai/conversations/${conversationId}/audio`,
      {
        headers: {
          'xi-api-key': apiKey
        }
      }
    );

    if (!response.ok) {
      return {
        statusCode: response.status,
        body: JSON.stringify({ error: 'API call failed' })
      };
    }

    const audioBuffer = await response.arrayBuffer();
    const base64Audio = Buffer.from(audioBuffer).toString('base64');

    return {
      statusCode: 200,
      headers: {
        'Content-Type': 'application/json',
        'Access-Control-Allow-Origin': '*'
      },
      body: JSON.stringify({
        audio: `data:audio/mpeg;base64,${base64Audio}`
      })
    };
  } catch (error) {
    return {
      statusCode: 500,
      body: JSON.stringify({ error: error.message })
    };
  }
};
        </div>

        <h2>해결 방법 3: 코드 수정</h2>
        
        <p>프록시 서버를 사용하도록 코드를 수정합니다:</p>

        <div class="code">
// elevenlabs-config.js 수정
const ELEVENLABS_CONFIG = {
  API_KEY: 'sk_82e5a6661ba4fc783eebde024664b818b225785cd8950b49',
  CONVERSATION_ID: 'conv_8801k49p1qjaf8q8vqt64aqv4gby',
  
  // 프록시 서버 사용
  USE_PROXY: true,
  PROXY_URL: 'http://localhost:3001/api/elevenlabs', // 로컬 프록시
  // 또는 Netlify Functions 사용 시:
  // PROXY_URL: '/.netlify/functions/elevenlabs-proxy',
  
  // 직접 API 호출 (CORS 문제 있을 수 있음)
  BASE_URL: 'https://api.elevenlabs.io/v1'
};
        </div>

        <div class="success">
            <strong>권장사항:</strong> 프로덕션 환경에서는 백엔드 서버를 통해 API 호출을 처리하는 것이 가장 안전합니다.
        </div>

        <h2>테스트 방법</h2>
        
        <p>브라우저 개발자 도구의 콘솔에서 다음을 확인하세요:</p>
        
        <div class="code">
// 설정 확인
console.log('API 설정:', window.ELEVENLABS_CONFIG);

// 수동 API 테스트
fetch('/api/elevenlabs/convai/conversations/conv_8801k49p1qjaf8q8vqt64aqv4gby/audio', {
  headers: {
    'x-api-key': 'sk_82e5a6661ba4fc783eebde024664b818b225785cd8950b49'
  }
})
.then(response => {
  console.log('응답 상태:', response.status);
  return response.blob();
})
.then(blob => {
  console.log('오디오 크기:', blob.size, 'bytes');
  const audioUrl = URL.createObjectURL(blob);
  console.log('오디오 URL:', audioUrl);
});
        </div>
    </div>
</body>
</html>
