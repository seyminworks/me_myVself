<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>@lee_byungyeob — Generated Self</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../assets/css/style.css" />
  <link rel="stylesheet" href="persona.css" />
  <script src="elevenlabs-config.js"></script>
  <!-- ElevenLabs Widget Script -->
  <script src="https://unpkg.com/@elevenlabs/convai-widget-embed" async type="text/javascript"></script>
</head>

<body>
  <header>
    <a href="../../index.html" style="text-decoration: none; color: inherit;">
      <div class="logo">생성된 자아들 / Generated Selves</div>
    </a>
    <nav>
      <a href="../../index.html">Home</a>
      <a href="../../about.html">About</a>
      <a href="#">Contact</a>
      <a href="https://www.totheotherside.kr/" target="_blank">TTOS</a>
    </nav>
  </header>

  <div class="container">
    <a href="../../index.html" class="back-button">← Back</a>

    <div class="detail-header">
      <h1 class="detail-title">@lee_byungyeob</h1>
      <p class="detail-subtitle">심미적 관찰자 · Aesthetic Observer</p>

      <p class="core-identity-description">
        현실의 구조와 빛을 포착하는 <strong>심미적 관찰자(Aesthetic Observer)</strong>입니다.
        물리적 공간의 질서와 비물질적 시간의 흐름을 기록하며, 단순한 건축가가 아닌
        <strong>'삶의 배경을 조율하는 자'</strong>로서 존재합니다.
        침묵 속에 내재된 욕망과 규칙을 시각화하는 인격체입니다.
      </p>

      <p class="core-identity-keywords">
        #REFLECTION #ARCHITECTURE #MINIMALISM #SILENCE #ORDER
      </p>
    </div>

    <div class="detail-content">
      <div class="top-section">
        <div class="video-section">
          <!-- Placeholder for Video -->
          <div style="position: relative; width: 100%; padding-bottom: 56.25%; height: 0; background: #000;">
            <iframe src="https://www.youtube.com/embed/wK8t62tifCg" title="YouTube video player"
              style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;" frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen></iframe>
          </div>
        </div>

        <div class="audio-section-left">
          <h3>녹음된 대화 (Recorded Conversation) / 2025-12-21</h3>
          <div class="audio-container">
            <div class="audio-player-compact">
              <audio id="conversationAudio" controls preload="metadata">
                <source src="" type="audio/mpeg">
                <source src="" type="audio/wav">
                브라우저가 오디오 재생을 지원하지 않습니다.
              </audio>
            </div>
            <div class="audio-controls-compact">
              <button id="loadConversationBtn" class="load-btn">대화 불러오기</button>
              <button id="downloadAudioBtn" class="download-btn" style="display: none;">다운로드</button>
            </div>
          </div>
        </div>
      </div>

      <div class="middle-section">
        <div class="transcript-section-right">
          <h3>대화 내용 (Transcript) / 2025-12-21</h3>
          <div class="transcript-container">
            <div class="transcript-header">
              <div class="transcript-controls">
                <button id="loadTranscriptBtn" class="load-btn">트랜스크립트 불러오기</button>
                <button id="toggleTranscriptBtn" class="toggle-btn" style="display: none;">보기/숨기기</button>
              </div>
            </div>

            <div id="transcriptContent" class="transcript-content-wide" style="display: none;">
              <div class="loading" id="transcriptLoading">트랜스크립트를 불러오는 중...</div>
              <div id="transcriptText" class="transcript-text-wide" style="display: none;"></div>
            </div>
          </div>
        </div>

        <div class="agent-section">
          <h3>자아와 대화하기 (Talking to the Self) / 10min. max.</h3>
          <div id="widgetContainer" class="widget-container">
            <elevenlabs-convai agent-id="agent_4201kcxxsdfmfyy9tjeea75qbt2j"></elevenlabs-convai>
          </div>
        </div>
      </div>

      <div class="persona-overview">
        <div class="overview-section">
          <h3 class="overview-title">시각적 자아 (Visual Self)</h3>
          <div class="overview-content">
            <p><strong>정제된 고요함 (Refined Silence)</strong></p>
            <p>물성과 빛의 조화를 통한 구조적 미학을 추구합니다.</p>
            <ul>
              <li>White & Concrete의 중성적 톤</li>
              <li>직선과 기하학적 구도</li>
              <li>그림자를 통한 깊이감 연출</li>
            </ul>
          </div>
        </div>

        <div class="overview-section">
          <h3 class="overview-title">사회적 자아 (Social Self)</h3>
          <div class="overview-content">
            <p><strong>거리 두는 관조자 (Distanced Observer)</strong></p>
            <p>개입보다는 관찰을, 말보다는 기록을 선호합니다.</p>
            <ul>
              <li>감정을 절제한 건조한 어조</li>
              <li>타인과 적당한 거리를 유지하는 태도</li>
              <li>취향을 매개로 한 선별적 교류</li>
            </ul>
          </div>
        </div>

        <div class="overview-section">
          <h3 class="overview-title">개념적 자아 (Conceptual Self)</h3>
          <div class="overview-content">
            <p><strong>철학적 건축가 (Philosophical Architect)</strong></p>
            <p>공간에 시간을 덧입혀 인격을 부여합니다.</p>
            <ul>
              <li>사물과의 대화 (Object-Oriented Ontology)</li>
              <li>도시의 맥락을 읽어내는 해석자</li>
              <li>이상적 주체로서의 삶 추구</li>
            </ul>
          </div>
        </div>

        <div class="overview-section">
          <h3 class="overview-title">핵심 특성</h3>
          <div class="overview-content">
            <ul>
              <li><strong>심미적 감수성:</strong> 9.5/10</li>
              <li><strong>직업적 전문성:</strong> 8.5/10</li>
              <li><strong>분석적 깊이:</strong> 8.0/10</li>
              <li><strong>사회적 친밀도:</strong> 3.0/10</li>
              <li><strong>회고적 성향:</strong> 7.5/10</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="cta-section">
        <h2 class="cta-title">더 자세한 분석 보기</h2>
        <div class="cta-buttons">
          <a href="analysis_report.html" class="cta-button">심층 분석 리포트</a>
          <a href="infographic_lee_byungyeob.html" class="cta-button">전체 분석 리포트</a>
          <a href="https://instagram.com/lee_byungyeob" class="cta-button" target="_blank">Instagram 보기</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Configuration
    // Configuration
    const config = window.ELEVENLABS_CONFIG || {
      API_KEY: 'YOUR_ELEVENLABS_API_KEY',
      BASE_URL: 'https://api.elevenlabs.io/v1',
      CONVERSATION_IDS: []
    };

    const configErrors = window.validateConfig ? window.validateConfig() : [];
    if (configErrors.length > 0) {
      console.warn('ElevenLabs 설정 오류:', configErrors);
    }

    let currentAudioUrl = null;
    let currentTranscript = null;

    const loadConversationBtn = document.getElementById('loadConversationBtn');
    const loadTranscriptBtn = document.getElementById('loadTranscriptBtn');
    const downloadAudioBtn = document.getElementById('downloadAudioBtn');
    const toggleTranscriptBtn = document.getElementById('toggleTranscriptBtn');
    const conversationAudio = document.getElementById('conversationAudio');
    const transcriptContent = document.getElementById('transcriptContent');
    const transcriptText = document.getElementById('transcriptText');
    const transcriptLoading = document.getElementById('transcriptLoading');
    const widgetContainer = document.getElementById('widgetContainer');

    // Widget expansion logic
    let isWidgetExpanded = false;
    function expandWidget() {
      if (widgetContainer && !isWidgetExpanded) {
        widgetContainer.classList.add('expanded');
        isWidgetExpanded = true;
      }
    }
    if (widgetContainer) {
      try {
        const widgetElement = document.querySelector('elevenlabs-convai');
        if (widgetElement) {
          widgetElement.addEventListener('click', expandWidget);
        }
      } catch (e) { }
    }

    loadConversationBtn.addEventListener('click', loadConversationAudio);
    loadTranscriptBtn.addEventListener('click', loadTranscript);
    downloadAudioBtn.addEventListener('click', downloadAudio);
    toggleTranscriptBtn.addEventListener('click', toggleTranscript);

    // Mock functions for "Recorded Conversation"
    async function loadConversationAudio() {
      try {
        loadConversationBtn.textContent = '불러오는 중...';
        loadConversationBtn.disabled = true;

        const ids = config.CONVERSATION_IDS || (config.CONVERSATION_ID ? [config.CONVERSATION_ID] : []);
        if (!ids || ids.length === 0) {
          console.warn('대화 ID가 설정되지 않았습니다.');
          return;
        }

        console.log('오디오 목록 로드 시작...', ids);

        const audioUrls = [];
        for (const id of ids) {
          if (id) {
            try {
              const url = await fetchConversationAudio(id);
              if (url) audioUrls.push(url);
            } catch (e) {
              console.error(`대화 ID ${id}의 오디오 로드 실패:`, e);
            }
          }
        }

        if (audioUrls.length > 0) {
          let currentAudioIndex = 0;
          conversationAudio.src = audioUrls[0];
          currentAudioUrl = audioUrls[0];

          // 순차 재생 로직
          conversationAudio.onended = function () {
            currentAudioIndex++;
            if (currentAudioIndex < audioUrls.length) {
              console.log(`다음 오디오 재생: ${currentAudioIndex + 1}/${audioUrls.length}`);
              conversationAudio.src = audioUrls[currentAudioIndex];
              conversationAudio.play().catch(e => console.error('자동 재생 실패:', e));
            } else {
              console.log('모든 오디오 재생 완료');
              currentAudioIndex = 0; // 초기화
            }
          };

          downloadAudioBtn.style.display = 'inline-block';

          loadConversationBtn.textContent = `오디오 로드 완료 (${audioUrls.length}개)`;
          loadConversationBtn.style.background = '#000';
          console.log('오디오 로드 성공, 총 개수:', audioUrls.length);
        } else {
          throw new Error('재생할 오디오를 찾을 수 없습니다.');
        }

      } catch (error) {
        console.error('오디오 로드 실패:', error);
        alert(`오디오를 불러오는 중 오류가 발생했습니다: ${error.message}`);
        loadConversationBtn.textContent = '대화 불러오기';
        loadConversationBtn.style.background = '#000';
      } finally {
        loadConversationBtn.disabled = false;
      }
    }


    async function loadTranscript() {
      try {
        loadTranscriptBtn.textContent = '불러오는 중...';
        loadTranscriptBtn.disabled = true;
        transcriptContent.style.display = 'block';
        transcriptLoading.style.display = 'block';
        transcriptText.style.display = 'none';

        const ids = config.CONVERSATION_IDS || (config.CONVERSATION_ID ? [config.CONVERSATION_ID] : []);
        let allTranscripts = [];

        for (const id of ids) {
          if (id && id !== 'YOUR_SECOND_CONVERSATION_ID') {
            const transcript = await fetchTranscript(id);
            if (transcript) {
              let messages = [];
              if (Array.isArray(transcript)) {
                messages = transcript;
              } else if (transcript.messages && Array.isArray(transcript.messages)) {
                messages = transcript.messages;
              } else if (transcript.conversation && Array.isArray(transcript.conversation)) {
                messages = transcript.conversation;
              }
              allTranscripts = allTranscripts.concat(messages);
            }
          }
        }

        // 시간순 정렬 (timestamp가 있는 경우)
        allTranscripts.sort((a, b) => {
          const tA = a.timestamp || a.created_at || 0;
          const tB = b.timestamp || b.created_at || 0;
          return tA < tB ? -1 : (tA > tB ? 1 : 0);
        });

        if (allTranscripts.length > 0) {
          currentTranscript = allTranscripts;
          displayTranscript(allTranscripts);
          toggleTranscriptBtn.style.display = 'inline-block';
          loadTranscriptBtn.textContent = '트랜스크립트 불러오기 완료';
          loadTranscriptBtn.style.background = '#000';
          expandWidget();
        } else {
          console.warn('불러온 트랜스크립트가 없습니다.');
          // 데모 데이터 표시 혹은 알림
          displayTranscript(getDemoTranscript()); // Fallback
        }
      } catch (error) {
        console.error('트랜스크립트 로드 실패:', error);
        alert('트랜스크립트를 불러오는 중 오류가 발생했습니다.');
        loadTranscriptBtn.textContent = '트랜스크립트 불러오기';
        loadTranscriptBtn.style.background = '#000';
      } finally {
        loadTranscriptBtn.disabled = false;
        transcriptLoading.style.display = 'none';
      }
    }

    async function fetchConversationAudio(conversationId) {
      if (config.API_KEY === 'YOUR_ELEVENLABS_API_KEY' || !conversationId) {
        console.warn('ElevenLabs API 설정이 완료되지 않았습니다. 데모 모드로 실행됩니다.');
        return getDemoAudioUrl();
      }

      try {
        const baseUrl = config.USE_PROXY ? config.PROXY_URL : config.BASE_URL;
        const endpoint = config.USE_PROXY
          ? `/convai/conversations/${conversationId}/audio`
          : `/convai/conversations/${conversationId}/audio`;

        const url = `${baseUrl}${endpoint}`;
        console.log('API 호출 URL:', url);

        const headers = {
          'Accept': 'audio/mpeg'
        };

        if (config.USE_PROXY) {
          headers['x-api-key'] = config.API_KEY;
        } else {
          headers['xi-api-key'] = config.API_KEY;
        }

        const response = await fetch(url, {
          method: 'GET',
          headers: headers
        });

        if (!response.ok) {
          throw new Error(`API 호출 실패: ${response.status} - ${response.statusText}`);
        }

        const blob = await response.blob();
        return URL.createObjectURL(blob);
      } catch (error) {
        console.error('오디오 로드 실패:', error);
        throw error;
      }
    }

    async function fetchTranscript(conversationId) {
      try {
        console.log('트랜스크립트 API 호출 시작:', conversationId);

        const response = await fetch(`${config.BASE_URL}/convai/conversations/${conversationId}`, {
          method: 'GET',
          headers: {
            'xi-api-key': config.API_KEY,
            'Accept': 'application/json'
          }
        });

        if (!response.ok) {
          throw new Error(`API 호출 실패: ${response.status} - ${response.statusText}`);
        }

        const data = await response.json();
        return data.transcript || [];
      } catch (error) {
        console.error('트랜스크립트 로드 실패:', error);
        return null;
      }
    }

    function displayTranscript(transcript) {
      transcriptText.innerHTML = '';
      transcript.forEach(entry => {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message';

        const roleDisplay = entry.role === 'user' ? '사용자' : '@lee_byungyeob';

        const speakerSpan = document.createElement('span');
        speakerSpan.className = 'speaker';
        speakerSpan.textContent = roleDisplay;

        const textSpan = document.createElement('span');
        textSpan.textContent = entry.message;

        messageDiv.appendChild(speakerSpan);
        messageDiv.appendChild(textSpan);
        transcriptText.appendChild(messageDiv);
      });

      transcriptText.style.display = 'block';
    }

    function toggleTranscript() {
      const isVisible = transcriptText.style.display !== 'none';
      transcriptText.style.display = isVisible ? 'none' : 'block';
      toggleTranscriptBtn.textContent = isVisible ? '트랜스크립트 보기' : '트랜스크립트 숨기기';
    }

    function downloadAudio() {
      if (currentAudioUrl) {
        const a = document.createElement('a');
        a.href = currentAudioUrl;
        a.download = 'lee_byungyeob_conversation_20251221.mp3';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }
    }

    // Placeholder Data - To be updated with actual content generated by AI
    function getDemoAudioUrl() {
      return null;
    }

    function getDemoTranscript() {
      return [
        { role: 'user', message: '건축이란 무엇이라고 생각하시나요?' },
        { role: 'assistant', message: '건축은... 공간에 시간을 입히는 작업입니다. 단순히 벽을 세우는 것이 아니라, 빛이 머물렀다 가는 자리를 마련하고, 그 안에 담길 침묵을 설계하는 것이죠.' },
        { role: 'user', message: '침묵을 설계한다니 인상적이네요.' },
        { role: 'assistant', message: '네, 소란스러운 세상에서 잠시 멈춰 설 수 있는 공백. 그것이 제가 짓고 싶은 집의 본질입니다.' }
      ];
    }
  </script>
</body>

</html>
